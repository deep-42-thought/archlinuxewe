# Maintainer: Erich Eckner <arch at eckner dot net>
# Contributor: Xavier Devlamynck <magicrhesus@ouranos.be>
# Contributor: Aleshus <aleshusi@gmail.com>

pkgname=sipp
pkgver=3.6.0
pkgrel=1
pkgdesc="A free Open Source test tool / traffic generator for the SIP protocol."
arch=('i686' 'pentium4' 'x86_64')
url="http://sipp.sourceforge.net/"
license=('GPL')
depends=('openssl' 'libpcap' 'lksctp-tools')
makedepends=('gcc8')
source=(https://github.com/SIPp/${pkgname}/releases/download/v${pkgver}/sipp-${pkgver}.tar.gz)
sha512sums=('eecbc18a18558a3fbc4f7c841d1fc8bd5be4b0c5d2bb363a12faf730f3c6a0773a24f07dbf062e68baf1a93b21686fa09258d0e08b45b4f941eb5d573bb25c12')

build() {
  cd "${srcdir}/${pkgname}-${pkgver}"
  sed -i 's/SSL_library_init/SSL_CTX_new/' configure.ac
  sed -i 's/CRYPTO_num_locks/CRYPTO_free/' configure.ac
  sed -i 's/TLSv1_method/TLS_method/' src/socket.cpp
  CC=/usr/bin/gcc-8 \
  CXX=/usr/bin/g++-8 \
  ./build.sh --with-pcap --with-sctp --with-openssl
}

package() {
  cd "${srcdir}/${pkgname}-${pkgver}"
  install -D -m0755 "${pkgname}" "${pkgdir}/usr/bin/${pkgname}"
}

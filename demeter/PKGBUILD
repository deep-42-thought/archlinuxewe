# Maintainer: Erich Eckner <arch at eckner dot net>
pkgname=demeter
pkgver=0.9.24
pkgrel=1
pkgdesc="Data Analysis Tools for X-ray Spectroscopy"
arch=('x86_64' 'i686')
url="https://bruceravel.github.io/demeter"
license=('BSD')
groups=()
depends=(
    'ifeffit'
    'perl-module-build'
    'perl-archive-zip'
    'perl-capture-tiny'
    'perl-chemistry-elements'
    'perl-config-ini'
    'perl-const-fast'
    'perl-datetime'
    'perl-encoding-fixlatin'
    'perl-file-copy-recursive'
    'perl-file-countlines'
    'perl-file-touch'
    'perl-file-which'
    'perl-graph'
    'perl-html-parser'
    'perl-heap'
    'perl-json'
    'perl-math-combinatorics'
    'perl-math-derivative'
    'perl-math-random'
    'perl-math-round'
    'perl-math-spline'
    'perl-moose'
    'perl-moosex-aliases'
    'perl-moosex-types'
    'perl-moosex-types-laxnum'
    'perl-pdl'
    'perl-pdl-stats'
    'perl-pod-pom'
    'perl-regexp-assemble'
    'perl-regexp-common'
    'perl-spreadsheet-writeexcel'
    'perl-statistics-descriptive'
    'perl-text-template'
    'perl-tree-simple'
    'perl-want'
    'perl-xmlrpc-lite'
    'perl-yaml-tiny'
    'perl-encoding-fixlatin-xs'
    'perl-file-monitor-lite'
    'perl-graphics-gnuplotif'
    'perl-term-sk'
    'perl-term-twiddle'
    'perl-wx'
    'perl-xmlrpc-lite'
)
makedepends=(
    'perl-capture-tiny'
    'perl-file-copy-recursive'
    'perl-file-slurper'
    'perl-image-size'
    'perl-ppi'
    'perl-ppi-html'
    'perl-pod-projectdocs'
    'perl-syntax-highlight-perl'
    'perl-template-toolkit'
)
checkdepends=()
optdepends=(
    'perl-encoding-fixlatin-xs'
    'perl-file-monitor-lite'
    'perl-graphics-gnuplotif'
    'perl-term-sk'
    'perl-term-twiddle'
    'perl-wx'
)
provides=()
conflicts=()
replaces=()
backup=()
options=()
source=(
    "${pkgname}-${pkgver}.tar.gz::https://github.com/bruceravel/${pkgname}/archive/${pkgver}.tar.gz"
)
sha256sums=('f85262921e9eb646c7989ee73da760edc5fa27d5b97d1a4b3e597cd750920d8a')

prepare() {

    cd ${pkgname}-${pkgver}
    rm t/t
    export PGPLOT_DIR='/usr/lib'

}

build() {
  ( export PERL_MM_USE_DEFAULT=1 PERL5LIB=""                 \
      PERL_AUTOINSTALL=--skipdeps                            \
      PERL_MM_OPT="INSTALLDIRS=vendor DESTDIR='$pkgdir'"     \
      PERL_MB_OPT="--installdirs vendor --destdir '$pkgdir'" \
      MODULEBUILDRC=/dev/null

    cd ${pkgname}-${pkgver}
    perl ./Build.PL
    ./Build
  )
}

check() {

    cd ${pkgname}-${pkgver}
    ./Build test

}

package() {

    cd ${pkgname}-${pkgver}
    ./Build install --help

#    sed "s|DEBUG = False|DEBUG = True|" -i setup.py

#    python2 setup.py build
#    python2 setup.py install --skip-build --root="${pkgdir}" --prefix=/usr

}
